{% load static %}
<!doctype html>
<html lang="es">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Resumen - Bolis Naturales</title>
    <link rel="stylesheet" href="{% static 'styles.css' %}" />
  </head>

  <body>
    <div class="container">
      <header class="header">
        <h1 class="titulo-marca">Resumen</h1>

        <nav class="nav">
          <a href="{% url 'catalogo' %}" class="btn btn-seguir">
            Seguir comprando
          </a>

          <!-- ‚úÖ Bot√≥n en header que env√≠a el form -->
          <button type="submit" form="form-pedido" class="btn btn-confirmar">
            Confirmar pedido
          </button>
        </nav>
      </header>

      <main style="padding: 16px">
        {% if error %}
        <p style="font-weight: 800; color: #b91c1c; margin-bottom: 12px">
          {{ error }}
        </p>
        {% endif %}

        {% if items %}

        <!-- ‚úÖ ARRIBA: INGRESA TUS DATOS -->
        <h2>Ingresa tus datos</h2>

        <p>
          <strong>Horarios de reparto:</strong><br />
          {{ horarios.lv }}<br />
          {{ horarios.sd }}
        </p>

        <!-- ‚úÖ id para que el bot√≥n del header lo pueda enviar -->
        <form id="form-pedido" method="post">
          {% csrf_token %}

          <label for="nombre">Nombre</label><br />
          <input
            id="nombre"
            name="nombre"
            type="text"
            required
            autocomplete="name"
            placeholder="Ej: Diego"
            value="{{ request.POST.nombre|default:'' }}"
            style="
              width: 100%;
              padding: 12px;
              border-radius: 12px;
              border: 1px solid #e5e7eb;
              margin: 8px 0;
            "
          />

          <label for="telefono">Tel√©fono (10 d√≠gitos)</label><br />
          <input
            id="telefono"
            name="telefono"
            type="tel"
            required
            inputmode="numeric"
            maxlength="12"
            autocomplete="tel"
            placeholder="Ej: 916-555-1234"
            value="{{ request.POST.telefono|default:'' }}"
            style="
              width: 100%;
              padding: 12px;
              border-radius: 12px;
              border: 1px solid #e5e7eb;
              margin: 8px 0;
            "
          />
          <p style="margin: -2px 0 10px; font-size: 12px; color: #6b7280">
            Escribe tu n√∫mero (se formatea autom√°ticamente).
          </p>

          <label for="direccion">Direcci√≥n de env√≠o</label><br />
          <input
            id="direccion"
            name="direccion"
            type="text"
            required
            autocomplete="street-address"
            placeholder="Ej: 123 Main St, Sacramento"
            value="{{ request.POST.direccion|default:'' }}"
            style="
              width: 100%;
              padding: 12px;
              border-radius: 12px;
              border: 1px solid #e5e7eb;
              margin: 8px 0;
            "
          />

          <label for="mensaje">Mensaje (opcional)</label><br />
          <textarea
            id="mensaje"
            name="mensaje"
            rows="3"
            placeholder="Ej: Casa color azul / tocar timbre / etc."
            style="
              width: 100%;
              padding: 12px;
              border-radius: 12px;
              border: 1px solid #e5e7eb;
              margin: 8px 0;
            "
          >{{ request.POST.mensaje|default:'' }}</textarea>

          <hr />

          <!-- üì¶ TU PEDIDO -->
          <h2>Tu pedido</h2>

          <div class="breakfast-grid" style="grid-template-columns: 1fr">
            {% for it in items %}
            <article>
              <h3>{{ it.producto.nombre }}</h3>
              <p>Cantidad: <strong>{{ it.qty }}</strong></p>
              <p>Subtotal: <strong>${{ it.subtotal }}</strong></p>
            </article>
            {% endfor %}
          </div>

          <hr />

          <!-- üí∞ TOTALES -->
          <p><strong>Subtotal:</strong> ${{ subtotal }}</p>
          <p><strong>Env√≠o:</strong> ${{ envio }} (costo adicional)</p>
          <p><strong>Total:</strong> ${{ total }}</p>
        </form>

        {% else %}
        <p>No hay productos en tu carrito.</p>
        <a href="{% url 'catalogo' %}">Volver al cat√°logo</a>
        {% endif %}
      </main>
    </div>

    <!-- ‚úÖ Autoformato tel√©fono -->
    <script>
      document.addEventListener("DOMContentLoaded", function () {
        const telInput = document.getElementById("telefono");
        if (!telInput) return;

        telInput.addEventListener("input", function (e) {
          let digits = e.target.value.replace(/\D/g, "");
          digits = digits.substring(0, 10);

          let formatted = digits;

          if (digits.length > 6) {
            formatted =
              digits.substring(0, 3) +
              "-" +
              digits.substring(3, 6) +
              "-" +
              digits.substring(6);
          } else if (digits.length > 3) {
            formatted = digits.substring(0, 3) + "-" + digits.substring(3);
          }

          e.target.value = formatted;
        });
      });
    </script>
  </body>
</html>